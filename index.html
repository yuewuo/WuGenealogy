<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>吴氏支谱</title>
    <link type="text/css" rel="stylesheet" href="./jsmind.css"/>
    <link rel="shortcut icon" type="image/x-icon" href="./icon.jpg"/>
    <link rel="icon" type="image/x-icon" href="./icon.jpg"/>
</head>
<body>

<style type="text/css">
html, body {
    width: 100%;
    height: 100%;
    margin: 0;
}
#jsmind_container {
    width: 100%;
    height: 100%;
    border: none;
    background: #f4f4f4;
}
.search {
    position: fixed;
    top: 0;
    left:0;
    right:0;
    margin: 0 auto;
    max-width: 90vw;
    height: 46px;
    z-index: 100;
    margin-top: 10px;
}
.search-text {
    width: 35vw;
    height: 46px;
	background: white;
	border: 1px solid orange;
	border-radius: 3px;
    padding-left: 5vw;
    margin-right: 1vw;
}
.search-button {
    width: 20vw;
    height: 50px;
    margin-left: 1vw;
    margin-left: 1vw;
	background: white;
	border: 1px solid orange;
	border-radius: 3px;
}
</style>

<div id="jsmind_container"></div>
<script type="text/javascript" src="./jsmind.js"></script>

<!-- Search Block -->
<div class="search">
    <input class="search-text" placeholder="搜索……" id="search_name">
    <button class="search-button" onclick="show_person()">展开到人</button>
    <button class="search-button" onclick="show_all()">展开全部</button>
</div>

<script type="text/javascript">
const origin_data = ["肆凡公", [["保赤公", [["贵珍公", []], ["玉珍公", [["再芳公", [["轮元", []], ["轮才", [["吴洪儒", []], ["吴成儒", []], ["吴崇儒", [["吴应金", [["吴立忠", []], ["吴立田", [["吴兆学", [["吴德路", [["吴云海", []]]], ["吴德怀", [["吴云庚", []], ["吴云西", []]]], ["吴德云", []], ["吴德琴", []]]], ["吴兆玉", [["吴德跃", [["吴怡", []], ["吴婧", []], ["吴云浩", []]]], ["吴德兰", []], ["吴德妹", []]]], ["吴兆富", [["吴德明", [["吴俊玲", []]]], ["吴艳华", []]]], ["吴兆旺", [["吴德桥", []], ["吴巧云", []]]]]]]], ["吴应祥", [["吴立香", []], ["吴立纯", [["吴兆春", [["吴德曲", [["吴云伟", []], ["吴新月", []]]], ["吴德敏", []]]]]], ["吴立良", []]]], ["吴应和", [["吴立培", [["吴兆林", [["吴德洪", [["吴晓霞", []], ["吴云峰", []]]], ["吴江", [["吴云高", []], ["吴云兰", []]]], ["吴超", [["吴云祥", []], ["吴冬梅", []]]], ["吴波", [["吴云勤", []]]], ["吴巧", []]]], ["吴兆庭", [["吴锐", []], ["吴坚", []]]]]], ["吴立殿", [["吴兆成", [["吴德阳", [["吴云根", []]]], ["吴德光", [["吴云琪", []]]]]]]], ["吴立仿", [["吴兆山", [["吴彩", [["吴云静", []]]], ["吴德花", []], ["吴德兰", []]]]]], ["吴立柱", [["吴兆连", [["吴伟", [["吴金遥", []], ["吴明宣", []]]]]], ["吴兆才", [["吴德华", []], ["吴翠霞", []]]]]]]]]], ["吴纯儒", [["吴应生", [["吴立基", [["吴兆汉", [["吴正东", [["吴云清", [["吴进恒", []]]]]], ["吴旭东", [["吴云唅", []]]]]]]]]], ["吴应全", [["吴立根", [["吴兆雄", [["吴德馀", [["吴云峰", [["吴雷霆", []]]]]], ["吴德林", [["吴明云", []]]], ["吴德益", [["吴明晓", []]]], ["吴德巧", []]]], ["吴兆洲", [["吴德明", [["吴云春", []]]], ["吴德珍", []], ["吴德亚", []]]]]], ["吴立万", [["吴兆娟", []], ["吴兆兰", []]]], ["吴立元", [["吴兆军", [["吴德喜", [["吴明星", [["吴雷洋", []]]]]], ["小巧", []]]], ["吴兆厂", [["吴勤凤", []], ["吴勤英", []]]], ["吴兆信", [["吴德美", []]]]]], ["吴立邦", [["吴兆祥", []], ["吴兆斌", []], ["圣", []], ["贤", []]]]]], ["吴应高", [["吴立桐", [["吴兆泰", [["吴斌", [["吴云龙", []]]], ["吴浩", [["吴云蛟", [["吴西", []]]]]], ["吴昌", []]]]]], ["吴立武", [["吴兆云", [["吴云峰", [["吴鸣航", []]]]]], ["吴兆东", [["吴鹏", []]]]]]]]]]]], ["轮全(特庸)", [["吴学儒", [["吴应锦", [["吴立恺", []], ["吴立芝", [["吴兆根", [["吴德龙", [["吴云汉", [["吴春梅", []]]]]], ["吴德玉", [["吴云军", [["吴志励", []]]]]], ["吴德郞", [["吴云峰", [["吴琳琳", []]]], ["吴雅翠", []]]], ["吴德富", [["吴云辉", [["吴梦涵", []]]]]]]], ["吴兆华", [["吴德珍", [["吴留君", []], ["吴云美", []]]]]]]]]], ["吴应馀", [["吴立成", [["吴兆其", [["吴德保", [["吴大霞", []], ["吴云飞", [["吴*娟", []]]]]]]], ["吴兆群", []], ["吴兆栾", [["吴德国", [["吴群珍", []]]], ["吴德连", [["吴云磊", [["吴雨桐", []]]], ["吴金金", []]]]]]]], ["吴立志", []]]], ["吴应怀", [["吴立香", [["吴兆堂", [["吴德才", [["吴云东", [["吴莹琼", []]]]]], ["吴德祥", [["吴云忠", [["吴奕彤", []]]], ["吴云娟", []]]], ["吴德俊", [["吴云箫", []], ["吴云详", []]]], ["吴德军", [["吴云清", [["吴昱颉", []]]]]], ["吴德全", [["吴云鹏", [["吴子琦", []]]]]]]], ["吴兆万", [["吴德群", [["吴云龙", [["吴浩然", []]]]]], ["吴德明", [["吴云海", [["吴欣怡", []]]]]], ["吴德亮", [["吴云伟", []], ["吴云馀", []]]]]]]], ["吴立旺", [["吴兆元", [["吴文兰", []]]], ["吴兆法", [["吴德文", [["吴云云", []]]], ["吴秀兰", []], ["吴秀凤", []]]], ["吴兆友", [["吴秀妹", []], ["吴秀勤", []], ["吴秀云", []]]]]], ["吴立周", [["吴兆桂", [["吴小艳", []], ["吴小娟", []]]]]], ["吴立凤", [["吴兆田", [["吴德生", []]]], ["吴兆才", [["吴德巡", [["吴*轩", []]]]]], ["吴兆喜", [["吴德道", []]]], ["吴兆良", [["吴德勇", [["吴*熙", []]]]]], ["吴兆荣", [["吴德金", [["吴路微", []]]]]]]]]], ["吴应安", [["吴立洪", [["吴兆生(领养)", [["吴德俊", [["张逸", []]]]]]]], ["吴立楼", [["吴兆兵", [["吴德春", [["吴云华", []], ["吴云彩", []]]], ["吴德忠", [["吴云迪", []]]], ["吴德玲", []]]]]]]], ["吴应龙", [["吴立信", [["吴兆连", [["吴德清", []], ["吴德胜", [["吴梓菡", []], ["吴佳颖", []]]]]], ["吴兆富", [["吴德喜", []], ["吴德勤", []]]]]], ["吴立标", [["吴兆军", []], ["吴兆青", [["吴征南", []]]]]]]]]], ["吴瑞儒", [["吴应书", [["吴立有", [["吴兆荣", [["吴德春", [["吴云华", []]]], ["吴德明", [["吴云艳", []]]], ["吴德均", [["吴云健", []]]]]], ["吴兆楼", [["吴德超", [["吴云星", []]]], ["吴德文", [["吴云松", []]]]]], ["吴兆府", [["吴德平", []], ["吴德花", []], ["吴德云", []]]], ["吴兆全", []]]], ["吴立松", []], ["吴立府", []], ["吴立德", []]]], ["吴应长", [["吴立庆", [["远迁失联", []]]], ["吴立进", [["远迁失联", []]]]]]]]]]]], ["仰山公", [["雅南", [["吴有儒", [["吴应清", [["吴立喜", [["生二女", []]]], ["吴立富", [["吴兆龙", [["吴德海", []], ["吴大伟", []], ["吴佩芬", []], ["吴益珍", []]]], ["吴兆金", [["吴德成", [["吴云亚", [["吴雷盛", []]]], ["吴慧", []]]], ["吴德勇", [["吴云艳", []], ["吴云云", []]]], ["吴德安", [["吴云川", [["吴雷雨", []]]]]], ["吴德友", [["吴巧梅", []], ["吴巧兰", []]]], ["吴红玉", []], ["吴红珍", []], ["吴红翠", []]]], ["吴兆坤", [["吴杰", [["吴云飞", [["吴佳轩", []], ["吴佳浩", []]]]]], ["吴迪", [["吴云辉", []]]], ["吴珊", []]]]]]]]]], ["吴明儒", [["吴应谦", [["生三女", []]]]]], ["吴良儒", [["吴应科", [["吴立国", [["吴兆桂", [["吴德轩", [["吴鸣宇", [["吴雷蔚", []]]]]], ["吴静", []]]], ["吴兆干", [["吴旭", [["吴鸣朗", [["吴雷春", []]]]]], ["吴芳", []], ["吴芬", []]]], ["吴兆岳", [["吴峰", []], ["吴云梦", []]]], ["吴兆康", [["吴辉", [["吴丹丹", []]]]]], ["吴兆健", [["吴川", [["吴鸣润", []], ["吴鸣灿", []]]]]]]]]]]]]], ["金元", [["吴彦儒", [["吴应栾", []]]]]], ["高元", [["吴德儒", [["吴应松", [["吴立玉", [["吴兆青", [["吴德普", []], ["吴德育", [["吴云豪", [["吴云连", []], ["吴伊涵", []]]]]], ["吴德森", [["吴云华", []]]]]], ["吴兆柏", [["吴德茂", [["吴佳怡", []]]], ["吴慧香", []]]], ["吴兆明", [["吴德军", [["吴晶晶", []]]]]]]], ["吴立顺", [["吴兆月", [["吴慧萍", []], ["吴德穆", []]]], ["吴兆瑞", [["吴春雨", [["吴炜", []]]]]]]], ["吴立标", [["吴兆洋", [["吴军", []]]], ["吴兆益", [["吴祥", []]]]]], ["吴立荣", [["吴兆石", [["吴德成", []], ["吴德伟", []]]]]]]], ["吴应才", [["吴立洪", [["生二女", []]]], ["吴立容", []]]], ["吴应万", [["吴立群", [["吴兆朋", [["吴德进", [["吴云伟", []]]], ["吴德山", [["吴云妍", []], ["吴云萍", []]]], ["吴德芳", []]]], ["吴兆祥", [["吴德选", [["吴云舜", []], ["吴铭萱", []]]], ["吴德军", [["吴云帆", []]]]]], ["吴兆恺", []], ["吴兆兵", [["吴艳", [["吴骆子玉", []]]], ["吴林", [["吴陈昊", []]]]]], ["吴兆庆", [["吴德立", [["吴明迪", []]]], ["吴德富", [["吴明杰", []]]]]], ["吴兆章", [["吴德松", [["吴沐泽", []]]], ["吴小梅", []]]], ["吴秀勤", []]]], ["吴立桃", [["吴兆如", [["吴德海", [["吴越", []]]], ["吴德建", [["吴清扬", []]]], ["吴志芳", []]]], ["吴兆秀", []], ["吴兆花", []]]], ["吴立岗", [["吴兆勤", [["吴志萍", []], ["吴志红", []]]]]]]], ["吴应春", [["吴立门", [["吴兆奎", [["吴德领", [["吴帆淇", []]]]]], ["吴兆平", [["吴德功", [["吴铭轮", []], ["吴云凡", []]]]]], ["吴兆灿", [["吴德克", [["吴佳瑜", []]]]]], ["吴兆新", [["吴琼", [["吴佳颖", []]]], ["吴涧", []]]], ["吴兆杰", [["吴限", [["吴令仪", []]]]]], ["吴兆茂", [["吴德溪", [["吴谭子蕊", []]]], ["吴君", []]]]]]]], ["吴应山", [["吴立政", [["吴兆伟", [["吴潇飞", []]]]]], ["吴立俊", [["吴兆超", [["吴德忠", [["吴铭杨", []]]]]], ["吴兆胜", [["吴蓉蓉", []]]], ["吴兆燕", []]]]]], ["吴顺祥", [["吴锦堂", [["吴波", []], ["吴红", []]]], ["吴锦梅", []]]]]]]]]]]]]]]]

var id_gen = 0;
function get_next_id() {
    id_gen += 1
    return "id_" + id_gen
}
var name_mapping = {}
function build_jsmind_tree_from_data(data, path = []) {
    const name = data[0]
    const child_data = data[1]
    const id = get_next_id()
    let tree = {
        id: id,
        topic: name,
    }
    if (!(name in name_mapping)) {
        name_mapping[name] = []
    }
    name_mapping[name].push(path)
    if (child_data.length > 0) {
        let children = []
        for (let i=0; i<child_data.length; ++i) {
            children.push(build_jsmind_tree_from_data(child_data[i], path.concat([id])))
        }
        tree["children"] = children
    }
    return tree
}

function load_jsmind() {
    let mind = {
        "meta": {
            "name": "吴氏支谱",
            "author": "yue.wu@yale.edu",
            "version": "0.1",
        },
        "format": "node_tree",
        "data": build_jsmind_tree_from_data(origin_data),
    }
    let options = {
        container: 'jsmind_container',
        editable: false,
        theme: 'yue',
        layout: {
            pspace: 20,
        },
    }
    return jsMind.show(options, mind)
}
var jm = load_jsmind()

var current_showing_all = true
function show_none() {
    jm.collapse_all()
}
function show_all() {
    current_showing_all = true
    jm.expand_all()
}
function show_person() {
    const name = document.getElementById("search_name").value
    if (!(name in name_mapping)) {
        alert("未找到该姓名")
        return
    }
    if (current_showing_all) {
        show_none()
        current_showing_all = false
    }
    paths = name_mapping[name]
    for (let i in paths) {
        const path = paths[i]
        for (let j in path) {
            const id = path[j]
            // console.log(id)
            jm.expand_node(id)
        }
    }
}

</script>

</body>
</html>
