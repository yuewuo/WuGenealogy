<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>吴氏支谱</title>
    <link type="text/css" rel="stylesheet" href="./jsmind.css"/>
    <link rel="shortcut icon" type="image/x-icon" href="./icon.jpg"/>
    <link rel="icon" type="image/x-icon" href="./icon.jpg"/>
</head>
<body>

<style type="text/css">
html, body {
    width: 100%;
    height: 100%;
    margin: 0;
}
#jsmind_container {
    width: 100%;
    height: 100%;
    border: none;
    background: #f4f4f4;
}
.search {
    position: fixed;
    top: 0;
    left:0;
    right:0;
    margin: 0 auto;
    max-width: 90vw;
    height: 46px;
    z-index: 100;
    margin-top: 10px;
}
.search-text {
    width: 35vw;
    height: 46px;
	background: white;
	border: 1px solid orange;
	border-radius: 3px;
    padding-left: 5vw;
    margin-right: 1vw;
    opacity: 0.7;
}
.search-button {
    width: 20vw;
    height: 50px;
    margin-left: 1vw;
    margin-left: 1vw;
	background: white;
	border: 1px solid orange;
	border-radius: 3px;
    opacity: 0.7;
}
</style>
<style type="text/css" media="print">
.search {
    display: none;
}
#jsmind_container {
    background: white;
}
jmnodes.theme-yue jmnode {
    color: black;
}
</style>

<!-- https://github.com/hizzgdev/jsmind/blob/master/docs/zh/1.usage.md -->
<div id="jsmind_container"></div>
<script type="text/javascript" src="./jsmind.js"></script>

<!-- Search Block -->
<div class="search">
    <input class="search-text" placeholder="搜索……" id="search_name">
    <button class="search-button" onclick="show_person()">展开到人</button>
    <button class="search-button" onclick="show_all()" id="toggle_show_all">展开全部</button>
</div>

<script type="text/javascript">
const origin_data = ["肆凡公", [["保赤公\n唐氏", [["贵珍公", []], ["玉珍公\n陈氏", [["再芳公\n孙氏", [["吴轮元", []], ["吴轮才\n韦氏", [["吴洪儒\n韩氏", []], ["吴成儒", []], ["吴崇儒\n袁氏", [["吴應金\n韦氏", [["吴立中\n蔡氏", []], ["吴立田\n仇学兰", [["吴兆学\n沈洪兰", [["吴德路\n马霞", [["吴云海", []]]], ["吴德怀\n孙丽", [["吴云庚", []], ["吴云雨", []]]], ["吴德云", []], ["吴德琴", []]]], ["吴兆玉\n胡龙兰", [["吴德耀\n王小慧", [["吴怡", []], ["吴婧", []], ["吴云浩", []]]], ["吴德兰", []], ["吴德妹", []]]], ["吴兆富\n李秀玲", [["吴艳明", [["吴俊玲", []]]], ["吴艳华", []]]], ["吴兆旺\n陈书勤", [["吴德桥", []], ["吴巧云", []]]]]]]], ["吴應祥\n陈氏", [["吴立香\n张秀芳", []], ["吴立纯\n仇学珍", [["吴兆春\n严玉芳", [["吴德曲\n陈静", [["吴云伟", []], ["吴新悦", []]]], ["吴德敏", []]]]]], ["吴立良\n陈玉美", []]]], ["吴應和\n李氏", [["吴立培\n李玉兰", [["吴兆林\n卞云芳", [["吴德洪\n周同英", [["吴晓霞", []], ["吴云峰", []]]], ["吴德江\n卞小玲", [["吴云高", []], ["吴云兰", []]]], ["吴德超\n江卫秀", [["吴云祥", []], ["吴冬梅", []]]], ["吴德波\n施永花", [["吴云勤", []]]], ["吴小巧", []]]], ["吴兆庭\n乔巧英", [["吴德锐", []], ["吴德坚", []]]]]], ["吴立殿\n严素珍", [["吴兆成\n黄玉兰", [["吴德洋\n孙同芬", [["吴云根", []]]], ["吴德光\n蔡哓宁", [["吴云琪", []]]]]]]], ["吴立仿\n陆玉珍\n陶长英", [["吴兆山\n项洪玲\n领养吴彩", [["吴德彩", [["吴云静", []]]], ["吴德花", []], ["吴德兰", []]]]]], ["吴立柱\n贾国珍", [["吴兆连\n韦友苹", [["吴德伟", [["吴金遥", []], ["吴明宣", []]]]]], ["吴兆才\n董湘莲", [["吴德华", []], ["吴翠霞", []]]]]]]]]], ["吴纯儒\n孙氏", [["吴應生\n王氏", [["吴立基\n陈秀玲\n过继立元次子兆汉", [["吴兆汉\n陈书秀", [["吴正东\n朱小红", [["吴云清\n郑妍", [["吴进恒", []]]]]], ["吴旭东\n徐翠春", [["吴云唅", []]]]]]]]]], ["吴應全\n卞氏", [["吴立根\n陆氏", [["吴兆雄\n周云秀", [["吴德馀\n张茂洪", [["吴云峰\n李亚", [["吴雷霆", []]]]]], ["吴德林\n钱志勤", [["吴明云\n杨大雷", []]]], ["吴德益\n蔡洪芳", [["吴明晓\n陈晶晶", []]]], ["吴德巧", []]]], ["吴兆洲\n孙月群", [["吴德明\n孙国秀", [["吴云春\n孙婷婷", []], ["吴艳", []]]], ["吴德珍", []], ["吴德亚", []]]]]], ["吴立万\n陈英", [["吴兆娟", []], ["吴兆兰\n杨从伟", []]]], ["吴立元\n吉素玲\n次子兆汉过继", [["吴兆军\n张志兰", [["吴德喜\n陆玉芳", [["吴明星\n庄一晶", [["吴雷洋", []]]], ["吴勤", []]]], ["吴小巧", []]]], ["吴兆厂\n张洪秀", [["吴勤凤", []], ["吴勤英", []]]], ["吴兆信\n王龙苹\n领养德美", [["吴德美", []]]]]], ["吴立邦\n刘卓萍", [["吴兆祥", []], ["吴兆斌", []]]]]], ["吴應高\n顾氏", [["吴立桐\n蒋翠芳", [["吴兆泰\n吉勤", [["吴斌\n蔡芬玲", [["吴云龙", []]]], ["吴浩\n周其芳", [["吴云蛟", [["吴西", []]]]]], ["吴昌", []]]]]], ["吴立武\n卞俊兰", [["吴兆云\n陈秋红", [["吴德峰", [["吴鸣航", []]]]]], ["吴兆东\n张琴", [["吴鹏", []]]]]]]]]]]], ["吴轮全(特庸)\n孙氏", [["吴学儒\n陈氏", [["吴應锦\n王氏", [["吴立恺\n陈氏", []], ["吴立芝\n李氏", [["吴兆根\n刘氏", [["吴德龙\n陈玉巧", [["吴云汉\n黄玲", [["吴春梅", []]]], ["吴翠玲", []], ["吴大玲", []]]], ["吴德玉\n徐凤英", [["吴云军\n徐月美", [["吴志励", []]]]]], ["吴德郞\n陈国芳", [["吴云峰\n严金凤", [["吴琳琳", []]]], ["吴雅翠", []]]], ["吴德富\n孙洪霞", [["吴云辉\n张书丽", [["吴梦涵", []]]]]]]], ["吴兆华\n孙氏", [["吴德珍\n陈祝楼", [["吴留君", []], ["吴云美", []]]]]]]]]], ["吴應余\n陈氏", [["吴立成\n薛氏", [["吴兆其\n吉氏", [["吴德保\n周桂勤", [["吴大霞", []], ["吴云飞\n庄仇丹", [["吴晨娟", []]]]]]]], ["吴兆群\n江月珍", []], ["吴兆銮\n高正英", [["吴德国\n郭志兰", [["吴群玲", []]]], ["吴德连\n周玉林", [["吴云磊\n吴丹", [["吴雨桐", []]]], ["吴金金", []]]]]]]], ["吴立志\n陈氏", []]]], ["吴應怀\n袁氏", [["吴立香\n陈徐氏", [["吴兆堂\n张氏", [["吴德才\n陈月巧", [["吴云东\n袁妹", [["吴莹琼", []]]]]], ["吴德祥\n张秀英", [["吴云忠\n钟志清", [["吴奕彤", []]]], ["吴云娟", []]]], ["吴德俊\n孙书凤", [["吴云箫", []], ["吴云萍", []]]], ["吴德均\n吉玲", [["吴云清\n徐正娟", [["吴昱颉", []]]]]], ["吴德全\n宋志霞", [["吴云鹏\n吴金凤", [["吴子琦", []]]]]]]], ["吴兆万\n陈志英", [["吴德群\n孙素花", [["吴云龙\n聂静", [["吴浩然", []]]]]], ["吴德明\n宋志兰", [["吴云海\n仇婉群", [["吴欣怡", []]]]]], ["吴德亮\n李永林", [["吴云伟", []], ["吴云馀", []]]]]]]], ["吴立旺\n袁氏", [["吴兆元\n徐安凤", [["吴文兰", []]]], ["吴兆法\n倪胜英", [["吴德文\n熊玉佐", [["吴云云", []]]], ["吴秀兰", []], ["吴秀凤", []]]], ["吴兆有\n刘金凤", [["吴秀勤", []], ["吴秀妹", []], ["吴秀云", []]]]]], ["吴立周\n刘氏", [["吴兆桂\n宋国美", [["吴小艳", []], ["吴小娟", []]]]]], ["吴立凤\n高氏", [["吴兆田\n王银珍", [["吴德生\n及三女", []]]], ["吴兆才\n孙玉莲", [["吴德巡\n赵文婷", [["吴煜轩", []]]], ["吴小亚", []]]], ["吴兆喜\n严洪霞", [["吴德道", []]]], ["吴兆良\n孙殿兰", [["吴德勇\n陈燕", [["吴晨熙", []]]]]], ["吴兆融\n张才妹", [["吴德金", [["吴路微", []]]]]]]]]], ["吴應安\n袁氏", [["吴立洪\n陈氏\n领养兆生", [["吴兆生\n陈玉芳", [["吴德俊\n张炳", [["张逸", []]]]]]]], ["吴立楼\n陈氏", [["吴兆斌\n刘秀芬", [["吴德春", [["吴云华", []], ["吴云彩", []]]], ["吴德忠\n徐干妹", [["吴云迪", []]]], ["吴德珍", []]]]]]]], ["吴應龙\n孙氏", [["吴立标\n陈氏", [["吴兆军", []], ["吴兆清\n米陟伟", [["吴征南", []]]]]], ["吴立信\n陈氏", [["吴兆连\n宋国英", [["吴德清", []], ["吴德胜", [["吴梓菡", []], ["吴佳颖", []]]]]], ["吴兆富\n刘翠荣", [["吴德喜", []], ["吴德勤", []]]]]]]]]], ["吴瑞儒\n孙氏", [["吴應书\n孙氏", [["吴立有\n唐氏", [["吴兆荣\n曹秀英", [["吴德春", [["吴云华", []]]], ["吴德明\n徐祝琴", [["吴云艳", []]]], ["吴德均", [["吴云健", []]]]]], ["吴兆楼\n陈书英", [["吴德超", [["吴云星", []]]], ["吴德文\n兰中秀", [["吴云松", []]]]]], ["吴兆府\n陈玉銮", [["吴德平\n许久红", [["吴云玉", []]]], ["吴德芲", []], ["吴德云", []]]], ["吴兆全", []]]], ["吴立松", []], ["吴立府", []], ["吴立德", []]]], ["吴應长\n石氏", [["吴立庆", [["远迁失联", []]]], ["吴立进", [["远迁失联", []]]]]]]]]]]], ["仰山公\n陈尤氏", [["吴雅南\n唐氏", [["吴有儒\n陆氏", [["吴應清\n孙氏", [["吴立富\n陈氏", [["吴兆龙\n黄牡丹\n陈秀英", [["吴德海", []], ["吴大伟\n领养", []], ["吴佩芬", []], ["吴益贞", []]]], ["吴兆金\n陈兰英", [["吴德成\n郭立霞\n郭立秀", [["吴云亚\n钱小玉", [["吴雷盛", []]]], ["吴慧", []]]], ["吴德勇\n刘启勤", [["吴云艳", []], ["吴云云", []]]], ["吴德安\n王万玉", [["吴云川\n王海梅", [["吴雷雨", []]]]]], ["吴德友\n袁秀花", [["吴巧梅", []], ["吴巧兰", []]]], ["吴红玉", []], ["吴红珍", []], ["吴红翠", []]]], ["吴兆崑\n刘亚芳", [["吴杰\n孙志勤", [["吴云飞\n陶飞", [["吴佳轩", []], ["吴佳浩", []]]]]], ["吴岱\n姜晓琴", [["吴云辉", []]]], ["吴珊", []]]], ["吴秀英", []], ["吴秀霞", []]]], ["吴立广\n卞氏", [["生三女", []]]], ["吴立喜\n朱才保", [["生二女\n子兆柱夭折", []]]]]]]], ["吴明儒\n孙氏", [["吴應谦", [["生三女", []]]]]], ["吴良儒\n尤李氏", [["吴應科\n孙氏", [["吴立国\n卞月珍", [["吴兆桂\n卞秀兰\n陈明", [["吴德轩", [["吴鸣宇\n徐伟伟", [["吴雷蔚", []]]]]], ["吴静", []]]], ["吴兆干\n欧洪兰", [["吴旭\n蔡琴", [["吴鸣朗\n董梅", [["吴雷春", []]]]]], ["吴芳", []], ["吴芬", []]]], ["吴兆岳\n徐明曙\n祁云兰", [["吴峰", []], ["吴云梦", []]]], ["吴兆康\n孙国珍", [["吴辉\n陈红勤", [["吴丹丹", []]]]]], ["吴兆健\n陈忠玉", [["吴川\n姜玲", [["吴鸣润", []], ["吴鸣灿", []]]]]]]]]]]]]], ["吴金元", [["吴彦儒\n尤氏", [["吴應鑾\n申氏", []]]]]], ["吴高元\n陆氏", [["吴德儒\n王氏", [["吴應松\n顾氏", [["吴立玉\n贾凤英", [["吴兆清\n王亚珍", [["吴德普", []], ["吴德育\n陈国娟", [["吴云豪\n李立玉", [["吴雷莲", []], ["吴伊涵", []]]]]], ["吴德森\n陈爱林", [["吴云华", []]]]]], ["吴兆柏\n贾仁秀", [["吴德茂\n张审花", [["吴佳怡", []]]], ["吴慧香", []]]], ["吴兆明\n沈菊芳", [["吴德军", [["吴晶晶", []]]]]]]], ["吴立顺\n耿建英", [["吴兆月\n夏国勤", [["吴慧萍", []], ["吴德穆", []]]], ["吴兆瑞\n萧干霞", [["吴春雨\n刘娟", [["吴炜", []]]]]]]], ["吴立标\n钱氏", [["吴兆洋\n王少勤", [["钱军", []]]], ["吴兆益\n陈亚芳", [["钱陈", []]]], ["钱月宾", []], ["钱洪宾", []]]], ["吴立荣\n薛文英", [["吴兆石\n卞单琴", [["吴德成", []], ["吴德伟", []]]], ["吴兆全", []]]]]], ["吴應才\n孙氏", [["吴立洪\n陈氏", [["生二女", []]]], ["吴立容", []]]], ["吴應萬\n韦氏", [["吴立群\n韦氏", [["吴兆朋\n陈玉庭", [["吴德进\n宗林霞", [["吴云伟", []]]], ["吴德山\n施娟\n朱伏华", [["吴云妍", []], ["吴云萍", []]]], ["吴德芳", []]]], ["吴兆祥\n孙汉凤", [["吴德选\n王梅\n赵月菊", [["吴旻萱", []], ["吴云舜", []]]], ["吴德军\n王芳", [["吴云帆", []]]]]], ["吴兆恺", []], ["吴兆兵\n胡士云", [["吴艳", [["吴骆子玉", []]]], ["吴林", [["吴陈昊", []]]]]], ["吴兆庆\n倪正英", [["吴德立\n黄小艳", [["吴明迪", []]]], ["吴德富\n严丽", [["吴明杰", []]]]]], ["吴兆章\n王玉兰", [["吴德松\n殷丽娜", [["吴沐泽", []]]], ["吴小梅", []]]], ["吴秀勤", []]]], ["吴立桃\n周秀芳", [["吴兆如\n季汉花", [["吴德海\n孟巧英", [["吴越", []]]], ["吴德建\n乔莹", [["吴清扬", []]]], ["吴志芳", []]]], ["吴兆秀", []], ["吴兆花", []]]], ["吴立岗\n蔡氏", [["吴兆勤\n董汉凤", [["吴志萍", []], ["吴志红", []]]]]]]], ["吴應春\n袁氏", [["吴立门\n张洪荣", [["吴兆奎\n陈林", [["吴德领\n张海生", [["吴帆淇", []]]]]], ["吴兆平\n尤茂兰", [["吴德功\n王茂勤", [["吴铭轮", []], ["吴云凡", []]]]]], ["吴兆灿\n李翠秀", [["吴德克\n蔡芬", [["吴佳瑜", []]]]]], ["吴兆新\n陈开转", [["吴琼\n蔡文君", [["吴佳颖", []]]], ["吴涧", []]]], ["吴兆杰\n周国翠", [["吴限\n郑丹红", [["吴令仪", []]]]]], ["吴兆茂\n陈开荣", [["吴德溪\n谭荣", [["吴谭子蕊", []]]], ["吴君", []]]]]]]], ["吴應山\n张氏", [["吴立政\n朱云珍", [["吴兆伟\n蔡丽", [["吴潇飞", []]]]]], ["吴立俊\n周翠玲", [["吴兆超\n张苹", [["吴德志\n李勇", [["吴铭杨", []]]]]], ["吴兆胜\n李惠玲", [["吴蓉蓉", []]]], ["吴兆燕", []]]]]], ["吴顺祥<nolink>", [["吴锦堂", [["吴波", []], ["吴红", []]]], ["吴锦梅", []]]]]]]]]]]]]]]]

var id_gen = 0;
function get_next_id() {
    id_gen += 1
    return "id_" + id_gen
}
var name_mapping = {}
function get_sub_names(name) {
    return name.split("\n")
}
function name_to_topic(name) {
    let lines = get_sub_names(name)
    let topic = lines[0]
    for (let i=1; i<lines.length; ++i) {
        topic += `<br><span style="font-size:70%;">${lines[i]}</span>`
    }
    return topic
}
function build_jsmind_tree_from_data(data, path = []) {
    let name = data[0]
    let nolink = false  // if true, then don't draw link to parent
    if (name.includes("<nolink>")) {
        name = name.replace("<nolink>", "")
        nolink = true
    }
    const child_data = data[1]
    const id = get_next_id()
    const new_path = path.concat([id])
    let tree = {
        id: id,
        topic: name_to_topic(name),
        nolink: nolink,
    }
    const sub_names = get_sub_names(name)
    for (let i in sub_names) {
        const sub_name = sub_names[i]
        if (!(sub_name in name_mapping)) {
            name_mapping[sub_name] = []
        }
        name_mapping[sub_name].push(new_path)
    }
    if (child_data.length > 0) {
        let children = []
        for (let i=0; i<child_data.length; ++i) {
            children.push(build_jsmind_tree_from_data(child_data[i], new_path))
        }
        tree["children"] = children
    }
    return tree
}

function load_jsmind() {
    let mind = {
        "meta": {
            "name": "吴氏支谱",
            "author": "yue.wu@yale.edu",
            "version": "0.1",
        },
        "format": "node_tree",
        "data": build_jsmind_tree_from_data(origin_data),
    }
    let options = {
        container: 'jsmind_container',
        editable: false,
        theme: 'yue',
        view: {
            engine: "svg",
        },
        layout: {
            pspace: 20,
        },
    }
    return jsMind.show(options, mind)
}
var jm = load_jsmind()
jm.collapse_all()
function look_at_node(node) {
    if (!jsMind.util.is_node(node)) {
        node = jm.get_node(node);
        if (!node) {
            logger.error('the node[id=' + node + '] can not be found.');
            return;
        }
    }
    // console.log(node)
    var outer_w = jm.view.e_panel.clientWidth;
    var outer_h = jm.view.e_panel.clientHeight;
    if (jm.view.size.w > outer_w) {
        var _offset = jm.view.get_view_offset();
        jm.view.e_panel.scrollLeft = _offset.x - outer_w / 2 + node._data.layout._pout_.x;
    }
    if (jm.view.size.h > outer_h) {
        jm.view.e_panel.scrollTop = (jm.view.size.h - outer_h) / 2 + node._data.layout._pout_.y;
    }
}

var current_showing_all = false
var toggle_show_all = document.getElementById("toggle_show_all")
function show_none() {
    jm.collapse_all()
}
function show_all() {
    if (current_showing_all) {
        jm.collapse_all()
        look_at_node("id_1")  // make sure root is in the screen
        toggle_show_all.innerHTML = "展开全部"
    } else {
        jm.expand_all()
        toggle_show_all.innerHTML = "收起全部"
    }
    current_showing_all = !current_showing_all
}
function show_person() {
    const name = document.getElementById("search_name").value
    if (!(name in name_mapping)) {
        alert("未找到该姓名")
        return
    }
    if (current_showing_all) {
        show_none()
        current_showing_all = false
        toggle_show_all.innerHTML = "展开全部"
    }
    paths = name_mapping[name]
    let last_node_id = null
    for (let i in paths) {
        const path = paths[i]
        for (let j in path) {
            const id = path[j]
            // console.log(id)
            if (j < path.length - 1) {
                jm.expand_node(id)
            } else {
                last_node_id = id
            }
        }
    }
    jm.select_node(last_node_id)
    look_at_node(last_node_id)
    setTimeout(() => {
        alert("找到" + paths.length + "位" + name)
    }, 10)
}

</script>

</body>
</html>
